<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HoloMentor | Acceso</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:,">
    <style>
        /* --- VARIABLES --- */
        :root {
            --primary: #6fa0e0;
            --bg-start: #eef7ff;
            --bg-end: #9bc5ff;
            --text-main: #475569;
            --text-light: #94a3b8;
            --glass-bg: rgba(255, 255, 255, 0.70);
            --glass-border: rgba(255, 255, 255, 0.8);
            --shadow-card: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --shadow-input: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #CFE4FF;
        }

        /* --- FONDO ANIMADO --- */
        #login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ambient-shape {
            position: absolute;
            filter: blur(90px);
            z-index: 0;
            opacity: 0.5;
            animation: float 10s infinite ease-in-out;
        }

        .shape-1 {
            top: -15%;
            left: -10%;
            width: 600px;
            height: 600px;
            background: #cbdcf5;
            border-radius: 50%;
        }

        .shape-2 {
            bottom: -15%;
            right: -5%;
            width: 500px;
            height: 500px;
            background: #a3c9ff;
            border-radius: 50%;
            animation-delay: -5s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0);
            }

            50% {
                transform: translate(30px, 40px);
            }
        }

        /* --- TARJETA PRINCIPAL --- */
        .main-card {
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 400px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: var(--shadow-card);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }

        /* --- UI ELEMENTS --- */
        /* --- LOGO PREMIUM --- */
        .logo-area {
            margin-bottom: 35px;
            display: flex;
            flex-direction: column;
            align-items: center;
            perspective: 1000px;
        }

        .logo-wrapper {
            width: fit-content;
            margin: 0 auto;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 24px;
            box-shadow: 0 4px 24px -1px rgba(0, 0, 0, 0.05);
            perspective: 1000px;
            transition: all 0.3s ease;
        }

        .main-logo-svg {
            width: 200px;
            color: var(--primary);
            height: auto;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: floatLogo 6s infinite ease-in-out;
            shape-rendering: geometricPrecision;
        }

        .logo-path-a {
            fill: none;
            stroke: currentColor;
            stroke-width: 49.3;
            stroke-dasharray: 4000;
            stroke-dashoffset: 4000;
            animation: drawPath 1.5s ease-out forwards;
        }

        .logo-path-b {
            fill: none;
            stroke: currentColor;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 49.3;
            stroke-dasharray: 4000;
            stroke-dashoffset: 4000;
            animation: drawPath 5s ease-out forwards 0.2s;
        }

        .logo-path-c {
            fill: currentColor;
            stroke: currentColor;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 26.6;
            opacity: 0;
            transform-origin: center;
            transform-box: fill-box;
            animation: fadeInScale 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards 0.6s, lookAround 8s infinite 2s;
        }

        @keyframes drawPath {
            to {
                stroke-dashoffset: 0;
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes floatLogo {

            0%,
            100% {
                transform: translateY(0) rotateY(0);
            }

            50% {
                transform: translateY(-10px) rotateY(8deg);
            }
        }

        /* --- BLINK ANIMATIONS (Path Morphing) --- */
        .eye-left {
            animation: drawPath 1.5s ease-out forwards, blinkPathLeft 5s infinite 2s !important;
        }

        .eye-right {
            animation: drawPath 1.5s ease-out forwards, blinkPathRight 5s infinite 2s !important;
        }

        @keyframes blinkPathLeft {

            0%,
            45%,
            55%,
            100% {
                d: path("m 803.38981,592.25277 c 0,88.96465 5.93388,161.08474 -113.49152,161.08475 -119.4254,10e-6 -113.49153,-72.12009 -113.49153,-161.08475 0,-88.96466 50.81189,-161.08476 113.49153,-161.08475 62.67964,0 113.49152,72.1201 113.49152,161.08475 z");
            }

            50% {
                /* Top Vertex moved to match Bottom Vertex Height approx */
                d: path("m 803.38981,592.25277 c 0,88.96465 5.93388,161.08474 -113.49152,161.08475 -119.4254,10e-6 -113.49153,-72.12009 -113.49153,-161.08475 0,88.96466 50.81189,161.08476 113.49153,161.08475 62.67964,0 113.49152,-72.1201 113.49152,-161.08475 z");
            }
        }

        @keyframes blinkPathRight {

            0%,
            45%,
            55%,
            100% {
                d: path("m 1345.3898,592.25277 c 0,88.96465 5.9339,161.08474 -113.4915,161.08475 -119.4254,10e-6 -113.4916,-72.12009 -113.4916,-161.08475 0,-88.96466 50.8119,-161.08476 113.4916,-161.08475 62.6796,0 113.4915,72.1201 113.4915,161.08475 z");
            }

            50% {
                /* Top Vertex moved to match Bottom Vertex Height approx */
                d: path("m 1345.3898,592.25277 c 0,88.96465 5.9339,161.08474 -113.4915,161.08475 -119.4254,10e-6 -113.4916,-72.12009 -113.4916,-161.08475 0,88.96466 50.8119,161.08476 113.4916,161.08475 62.6796,0 113.4915,-72.1201 113.4915,-161.08475 z");
            }
        }

        /* Clip Path Animations (No stroke drawing, just morphing) */
        .clip-left {
            animation: blinkPathLeft 5s infinite 2s !important;
        }

        .clip-right {
            animation: blinkPathRight 5s infinite 2s !important;
        }

        @keyframes blinkHide {

            0%,
            45% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }

            55%,
            100% {
                opacity: 1;
            }
        }

        .logo-wrapper:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }

        .logo-wrapper:hover .main-logo-svg {
            transform: scale(1.05) rotateY(10deg);
            color: #5d91d4;
        }

        .app-subtitle {
            font-size: 1rem;
            color: var(--text-main);
            font-weight: 600;
            letter-spacing: 1px;
            margin-top: 15px;
            opacity: 0.8;
        }

        /* Animaci√≥n de Vistas */
        .view-section {
            width: 100%;
            display: none;
            animation: fadeIn 0.4s ease forwards;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .divider {
            display: flex;
            align-items: center;
            color: var(--text-light);
            font-size: 0.85rem;
            margin: 20px 0;
            width: 100%;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #cbd5e1;
            opacity: 0.7;
        }

        .divider span {
            padding: 0 12px;
        }

        .btn-custom {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(to bottom, #7fabda, #6fa0e0);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.2s;
            margin-bottom: 12px;
            text-align: center;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.15);
        }

        /* Bot√≥n Instructor */
        .btn-instructor {
            background: linear-gradient(to bottom, #7f8bda, #6f7ae0);
        }

        .btn-ghost {
            background: transparent;
            color: var(--primary);
            box-shadow: none;
            font-size: 0.9rem;
            padding: 8px;
            margin-top: 5px;
            border: none;
            cursor: pointer;
            width: 100%;
        }

        .btn-ghost:hover {
            background: rgba(111, 160, 224, 0.1);
            transform: none;
            border-radius: 50px;
        }

        .input-group-custom {
            margin-bottom: 16px;
            position: relative;
            width: 100%;
        }

        .label-custom {
            display: block;
            color: #64748b;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 6px;
            margin-left: 8px;
            text-align: left;
        }

        .input-field {
            width: 100%;
            padding: 14px 20px;
            border-radius: 50px;
            border: 1px solid transparent;
            background: white;
            font-size: 1rem;
            color: var(--text-main);
            box-shadow: var(--shadow-input);
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: var(--primary);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(111, 160, 224, 0.15);
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 38px;
            color: #94a3b8;
            cursor: pointer;
            transition: color 0.2s;
            z-index: 5;
        }

        .toggle-password:hover {
            color: var(--primary);
        }

        .footer-links {
            margin-top: 25px;
            font-size: 0.75rem;
            color: var(--text-light);
            display: flex;
            gap: 15px;
            opacity: 0.8;
            justify-content: center;
        }

        .footer-links a {
            color: inherit;
            text-decoration: none;
        }
    </style>
</head>

<body>

    <div id="login-container">
        <div class="ambient-shape shape-1"></div>
        <div class="ambient-shape shape-2"></div>

        <div class="main-card">
            <div class="logo-area" title="¬°Soy el HoloMentor!">
                <div>
                    <svg class="main-logo-svg" viewBox="0 0 1088.7649 852.07928" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <clipPath id="clip-eye-left">
                                <path class="clip-left"
                                    d="m 803.38981,592.25277 c 0,88.96465 5.93388,161.08474 -113.49152,161.08475 -119.4254,10e-6 -113.49153,-72.12009 -113.49153,-161.08475 0,-88.96466 50.81189,-161.08476 113.49153,-161.08475 62.67964,0 113.49152,72.1201 113.49152,161.08475 z" />
                            </clipPath>
                            <clipPath id="clip-eye-right">
                                <path class="clip-right"
                                    d="m 1345.3898,592.25277 c 0,88.96465 5.9339,161.08474 -113.4915,161.08475 -119.4254,10e-6 -113.4916,-72.12009 -113.4916,-161.08475 0,-88.96466 50.8119,-161.08476 113.4916,-161.08475 62.6796,0 113.4915,72.1201 113.4915,161.08475 z" />
                            </clipPath>
                        </defs>
                        <g transform="translate(-285.32944,-133.48322)">
                            <path class="logo-path-a eye-left"
                                d="m 803.38981,592.25277 c 0,88.96465 5.93388,161.08474 -113.49152,161.08475 -119.4254,10e-6 -113.49153,-72.12009 -113.49153,-161.08475 0,-88.96466 50.81189,-161.08476 113.49153,-161.08475 62.67964,0 113.49152,72.1201 113.49152,161.08475 z" />
                            <path class="logo-path-a"
                                d="m 1170.3121,888.92622 c 0,39.03876 -3.9231,70.68594 -56.3284,70.68594 -52.4053,5e-5 -56.3285,-31.64714 -56.3285,-70.68594 0,-39.03878 28.8239,-70.68598 56.3285,-70.68597 27.5046,0 56.3284,31.6472 56.3284,70.68597 z" />
                            <path class="logo-path-a eye-right"
                                d="m 1345.3898,592.25277 c 0,88.96465 5.9339,161.08474 -113.4915,161.08475 -119.4254,10e-6 -113.4916,-72.12009 -113.4916,-161.08475 0,-88.96466 50.8119,-161.08476 113.4916,-161.08475 62.6796,0 113.4915,72.1201 113.4915,161.08475 z" />
                            <path class="logo-path-b"
                                d="m 867.00175,430.48341 c 0,135.62182 2.15606,203.59213 1.08831,269.64165 -1.06775,66.04952 171.67094,73.5806 199.33214,10.35492" />
                            <path class="logo-path-b" d="M 504.67797,431.77819 V 752.72734" />
                            <path class="logo-path-b" d="M 312.66514,431.77819 V 752.72734" />
                            <path class="logo-path-b"
                                d="m 492.07373,608.09068 c 0,0 -44.75169,20 -90.20932,20 -45.45763,0 -84.73984,-20 -84.73984,-20" />
                            <g clip-path="url(#clip-eye-left)">
                                <path class="logo-path-c"
                                    d="m 651.70552,604.41071 a 39.262405,69.895706 0 0 1 -39.2624,69.8957 39.262405,69.895706 0 0 1 -39.26241,-69.8957 39.262405,69.895706 0 0 1 39.26241,-69.89571 39.262405,69.895706 0 0 1 39.2624,69.89571 z" />
                            </g>
                            <g clip-path="url(#clip-eye-right)">
                                <path class="logo-path-c"
                                    d="m 1193.7055,604.41071 a 39.262405,69.895706 0 0 1 -39.2624,69.8957 39.262405,69.895706 0 0 1 -39.2624,-69.8957 39.262405,69.895706 0 0 1 39.2624,-69.89571 39.262405,69.895706 0 0 1 39.2624,69.89571 z" />
                            </g>
                            <path class="logo-path-b"
                                d="M 306.97944,960.42041 V 818.2067 c 0,0 22.25219,47.01191 58.43462,47.01191 36.18243,0 59.84268,-47.01191 59.84268,-47.01191 v 142.21371" />
                            <path class="logo-path-b"
                                d="m 606.3262,961.08271 h -116.5165 v -73.13682 -69.04944 h 116.94274" />
                            <path class="logo-path-b" d="m 492.35532,888.58782 h 69.70014" />
                            <path class="logo-path-b" d="m 858.94813,817.91032 h 143.98527" />
                            <path class="logo-path-b" d="m 929.48911,818.81032 v 141.61118" />
                            <path class="logo-path-b"
                                d="M 659.90801,960.52529 V 817.59406 l 143.95047,142.51849 -0.55314,-142.51848" />
                            <path class="logo-path-b"
                                d="m 1236.9737,959.79562 v -140.7473 c 0,0 112.4706,-9.47942 112.4706,45.72571 0,55.20513 -111.5875,48.70063 -111.5875,48.70063 0,0 0.7139,8.66862 16.0159,3.07244 40.6913,-3.10704 94.1962,13.2032 95.0036,41.45971" />
                            <path class="logo-path-b"
                                d="m 734.48856,353.65754 c -66.62517,-47.39408 -36.14765,-139.07468 -16.61394,-152.9345 95.80061,79.35249 142.2543,97.90482 207.10193,126.50294 -22.16356,-74.94164 8.11761,-130.87267 28.59846,-169.09461 66.73349,76.59656 132.37189,154.03407 241.68719,197.93017" />
                        </g>
                    </svg>
                </div>
                <div class="app-subtitle" id="dynamic-subtitle">Tu aula virtual, pero divertida</div>
            </div>

            <!-- Vista: Selecci√≥n de Rol -->
            <div id="view-role" class="view-section active">
                <div class="divider"><span>Inicia sesi√≥n c√≥mo:</span></div>
                <button class="btn-custom" onclick="goToLogin('Alumno')">Alumno</button>
                <div style="text-align:center; color:#94a3b8; font-size:0.9rem; margin-bottom:12px;">√≥</div>
                <button class="btn-custom btn-instructor" onclick="goToLogin('Instructor')">Instructor</button>
                <div class="divider" style="margin-top: 25px;"></div>
                <button class="btn-ghost" onclick="goToRegister()">¬øNuevo aqu√≠? Reg√≠strate gratis</button>
            </div>

            <!-- Login Alumno -->
            <div id="view-login-student" class="view-section">
                <div class="divider"><span>Acceso Alumno</span></div>

                <form onsubmit="handleLoginStudent(event)">
                    <div class="input-group-custom">
                        <label class="label-custom">Usuario</label>
                        <input type="text" id="user-student" class="input-field" placeholder="Tu usuario (ej: DS59102)"
                            required>
                    </div>
                    <div class="input-group-custom">
                        <label class="label-custom">Token de Acceso</label>
                        <input type="password" id="token-student" class="input-field"
                            placeholder="Tu token de acceso / contrase√±a" required>
                        <div class="toggle-password" onclick="togglePass('token-student')">üëÅÔ∏è</div>
                    </div>
                    <div style="margin-top:20px;">
                        <button type="submit" id="btn-login-student" class="btn-custom">Entrar como Alumno</button>
                    </div>
                </form>

                <button class="btn-custom" style="background: #a3bfd9; margin-top:5px;" onclick="goToRecovery()">He
                    olvidado mi contrase√±a</button>
                <button class="btn-ghost" onclick="goBack('view-role')" style="margin-top:15px;">‚Üê Volver</button>
            </div>

            <!-- Cambio de Contrase√±a (Force) -->
            <div id="view-change-password" class="view-section">
                <div class="divider"><span>Cambio de Contrase√±a Requerido</span></div>
                <p style="color: var(--text-light); font-size: 0.9rem; text-align: center; margin-bottom: 20px;">
                    Es tu primer inicio de sesi√≥n. Por seguridad, debes establecer una nueva contrase√±a personal.
                </p>

                <form onsubmit="handleChangePassword(event)">
                    <div class="input-group-custom">
                        <label class="label-custom">Nueva Contrase√±a</label>
                        <input type="password" id="new-password" class="input-field"
                            placeholder="Ingresa tu nueva contrase√±a" required minlength="4">
                        <div class="toggle-password" onclick="togglePass('new-password')">üëÅÔ∏è</div>
                    </div>
                    <div class="input-group-custom">
                        <label class="label-custom">Confirmar Contrase√±a</label>
                        <input type="password" id="confirm-password" class="input-field"
                            placeholder="Repite la contrase√±a" required minlength="4">
                        <div class="toggle-password" onclick="togglePass('confirm-password')">üëÅÔ∏è</div>
                    </div>

                    <div style="margin-top:20px;">
                        <button type="submit" id="btn-change-pass" class="btn-custom">Guardar Contrase√±a y
                            Entrar</button>
                    </div>
                </form>
            </div>

            <!-- Login Instructor -->
            <div id="view-login-instructor" class="view-section">
                <div class="divider"><span>Acceso Instructor</span></div>

                <form onsubmit="handleLoginInstructor(event)">
                    <div class="input-group-custom">
                        <label class="label-custom">Usuario Instructor</label>
                        <input type="text" id="user-instructor" class="input-field" placeholder="Usuario Instructor"
                            required>
                    </div>
                    <div class="input-group-custom">
                        <label class="label-custom">Contrase√±a</label>
                        <input type="password" id="pass-instructor" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        <div class="toggle-password" onclick="togglePass('pass-instructor')">üëÅÔ∏è</div>
                    </div>
                    <button type="submit" class="btn-custom btn-instructor" id="btnLoginInstructor">Entrar como
                        Instructor</button>
                </form>

                <button class="btn-custom" style="background: #a3bfd9; margin-top:5px;" onclick="goToRecovery()">He
                    olvidado mi contrase√±a</button>
                <button class="btn-ghost" onclick="goBack('view-role')" style="margin-top:15px;">‚Üê Volver</button>
            </div>

            <!-- Registro -->
            <div id="view-register" class="view-section">
                <div class="divider"><span>Crear Cuenta</span></div>
                <div class="input-group-custom">
                    <label class="label-custom">Nombre</label>
                    <input type="text" class="input-field" placeholder="Ej. Marty McFly">
                </div>
                <div class="input-group-custom">
                    <label class="label-custom">Email</label>
                    <input type="email" class="input-field" placeholder="correo@ejemplo.com">
                </div>
                <button class="btn-custom" onclick="doRegister()">Registrarse</button>
                <button class="btn-ghost" onclick="goBack('view-role')">Ya tengo cuenta</button>
            </div>

            <!-- Recuperar contrase√±a -->
            <div id="view-recovery" class="view-section">
                <div class="divider"><span>Recuperar</span></div>
                <p style="text-align:center; color:#64748b; margin-bottom:15px; font-size:0.9rem;">Te enviaremos un
                    c√≥digo m√°gico.</p>
                <div class="input-group-custom">
                    <label class="label-custom">Email</label>
                    <input type="email" class="input-field" placeholder="ejemplo@clase.com">
                </div>
                <button class="btn-custom" onclick="alert('C√≥digo enviado (simulado)')">Enviar C√≥digo</button>
                <button class="btn-ghost" onclick="goBack('view-role')" style="margin-top:10px;">Cancelar</button>
            </div>

            <div class="footer-links">
                <a href="#">Ayuda</a>
                <a href="#">Privacidad</a>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000'; // Ajustar seg√∫n entorno

        function switchView(id) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function goToLogin(role) {
            document.getElementById('dynamic-subtitle').innerText = role === 'Alumno' ? '¬°Hola Alumno!' : '¬°Hola Profe!';

            if (role === 'Alumno') {
                switchView('view-login-student');
            } else {
                switchView('view-login-instructor');
            }
        }

        function goToRegister() {
            document.getElementById('dynamic-subtitle').innerText = '√önete a la locura';
            switchView('view-register');
        }

        function goToRecovery() {
            document.getElementById('dynamic-subtitle').innerText = 'Recuperar acceso';
            switchView('view-recovery');
        }

        function goBack(target) {
            switchView(target);
            if (target === 'view-role') document.getElementById('dynamic-subtitle').innerText = 'Tu aula virtual, pero divertida';
        }

        function togglePass(id) {
            const x = document.getElementById(id);
            x.type = x.type === "password" ? "text" : "password";
        }

        function doRegister() {
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "Creando...";
            setTimeout(() => {
                alert("¬°Cuenta simulada creada!");
                goBack('view-role');
                btn.innerText = originalText;
            }, 1000);
        }

        // =============================================
        // LOGIN ALUMNO ‚Äî Fetch API Validation
        // =============================================
        async function handleLoginStudent(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-login-student');
            const userVal = document.getElementById('user-student').value;
            const tokenVal = document.getElementById('token-student').value;

            btn.innerText = "Validando...";
            btn.disabled = true;

            try {
                const response = await fetch(`${API_URL}/auth/login/student`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nombre: userVal, token: tokenVal })
                });

                if (response.ok) {
                    const data = await response.json();

                    // Guardar datos b√°sicos
                    sessionStorage.setItem('userRole', 'student');
                    sessionStorage.setItem('userId', data.alumno.id);
                    sessionStorage.setItem('userName', data.alumno.nombre);
                    sessionStorage.setItem('userAlias', data.alumno.alias || data.alumno.nombre);
                    localStorage.setItem('authToken', data.access_token);

                    // VERIFICAR SI DEBE CAMBIAR PASS
                    if (data.alumno.must_change_password) {
                        // Guardar credenciales temporales en memoria ram del JS (no storage persistente)
                        tempUserId = data.alumno.id;
                        tempOldPass = tokenVal; // El token usado es la old pass

                        // Mostrar pantalla de cambio de pass
                        document.getElementById("view-login-student").style.display = "none";
                        document.getElementById("view-change-password").style.display = "block";
                        // Feedback sutil
                        btn.innerText = "Entrar como Alumno";
                        btn.disabled = false;
                    } else {
                        // Flujo normal - Redirigir de inmediato
                        window.location.href = 'tutor.html';
                    }

                } else {
                    const errData = await response.json();
                    throw new Error(errData.detail || 'Error de autenticaci√≥n');
                }

            } catch (error) {
                alert("Error: " + error.message);
                btn.innerText = "Entrar como Alumno";
                btn.disabled = false;
            }
        }

        async function handleChangePassword(e) {
            e.preventDefault();
            const p1 = document.getElementById("new-password").value;
            const p2 = document.getElementById("confirm-password").value;
            const btn = document.getElementById("btn-change-pass");

            if (p1 !== p2) {
                alert("Las contrase√±as no coinciden.");
                return;
            }

            btn.innerText = "Actualizando...";
            btn.disabled = true;

            try {
                const response = await fetch(`${API_URL}/auth/change-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: tempUserId,
                        old_password: tempOldPass,
                        new_password: p1
                    })
                });

                if (response.ok) {
                    // Contrase√±a actualizada, redirigir de inmediato
                    window.location.href = 'tutor.html';
                } else {

                    const errData = await response.json();
                    throw new Error(errData.detail || 'Error al actualizar contrase√±a');
                }
            } catch (error) {
                alert("Error: " + error.message);
                btn.innerText = "Guardar Contrase√±a y Entrar";
                btn.disabled = false;
            }
        }

        let tempUserId = null;
        let tempOldPass = null;

        // ==================================================
        // LOGIN INSTRUCTOR ‚Äî Redirige SIEMPRE a instructor.html
        // ==================================================
        // ==================================================
        // LOGIN INSTRUCTOR ‚Äî Fetch API Validation
        // ==================================================
        async function handleLoginInstructor(e) {
            e.preventDefault();
            const btn = document.getElementById('btnLoginInstructor');
            const userVal = document.getElementById('user-instructor').value;
            const passVal = document.getElementById('pass-instructor').value;

            btn.innerText = "Validando...";
            btn.disabled = true;

            try {
                const response = await fetch(`${API_URL}/auth/login/instructor`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: userVal, password: passVal })
                });

                if (response.ok) {
                    const data = await response.json();

                    // Guardar datos b√°sicos
                    sessionStorage.setItem('userRole', 'Instructor');
                    sessionStorage.setItem('userId', data.instructor.id);
                    sessionStorage.setItem('userName', data.instructor.nombre);
                    sessionStorage.setItem('licenciaId', data.instructor.licencia_id);
                    localStorage.setItem('authToken', data.access_token);

                    window.location.href = "instructor.html";
                } else {
                    const errData = await response.json();
                    throw new Error(errData.detail || 'Error de autenticaci√≥n');
                }
            } catch (error) {
                alert("Error: " + error.message);
                btn.innerText = "Entrar como Instructor";
                btn.disabled = false;
            }
        }
    </script>
</body>

</html>